name: Documentation Test

on:
  pull_request:
    branches:
      - main
    paths:
      - 'docs/kthena/**'
  push:
    branches:
      - main
    paths:
      - 'docs/kthena/**'

jobs:
  docs_test:
    name: Docusaurus tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24.5.0'
          cache: 'npm'
          cache-dependency-path: './docs/kthena/package-lock.json'
      - name: Install dependencies
        working-directory: ./docs/kthena
        run: npm ci
      - name: Type check
        working-directory: ./docs/kthena
        run: npm run typecheck
      - name: Build documentation
        working-directory: ./docs/kthena
        run: npm run build

  # This job is used as a status check for branch protection
  # It will pass if the test job succeeds or is skipped (due to path filters)
  status-check:
    name: Docs Test Status Check
    runs-on: ubuntu-latest
    needs: docs_test
    if: always()
    permissions:
      contents: read
    steps:
      - name: Check test job status
        run: |
          if [ "${{ needs.docs_test.result }}" = "success" ] || [ "${{ needs.docs_test.result }}" = "skipped" ]; then
            echo "Documentation tests passed or were skipped"
            exit 0
          else
            echo "Documentation tests failed"
            exit 1
          fi